<!DOCTYPE html>
<html lang="en" ng-app="homepage">
<head>
<meta charset="utf-8" />


<title>Your Personal Homepage</title>
<link rel="stylesheet" href="css/homepage.css">

<link rel="stylesheet" href="http://static.zhihu.com/static/revved/-/css/z.5020d372.css">
<link rel="stylesheet" href="http://static.zhihu.com/static/revved/-/css/pages/profile/main.a4ee1916.css">
<link href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/shift.css" rel="stylesheet">
<link rel="stylesheet" href="http://s3.amazonaws.com/codecademy-content/courses/ltp/css/bootstrap.css">
<link rel="shortcut icon" href="css/icon1.png" />
</head>

<body class="zhi" ng-controller="homepageMani" ng-init="returnFBusername()">

<div><button type="button" class="btn btn-primary" ng-click="returnFBusername()">test</button></div>
<div class="page-wraper">
<div class="username">
	<h1 id="username" style="color:rgb(80,80,80);"></h1>
	<a href="/auth/logout/facebook" class="btn btn-primary" style="float:right;"><span class="fa fa-facebook"></span> Logout</a>
</div>
<div class="nav">
	<a href="question.html">Go back to General Carry Room</a>
</div>

<div class="profile-navbar clearfix">
	<a class="item home first active"
	href="index.html">
	<i class="icon icon-profile-tab-home"></i><span class="hide-text">Homepage</span>
	</a>
	<a class="item ">Likes
	<span class="num">{{likes}}</span>
	received
	</a>
	<a class="item ">Dislike
	<span class="num">{{dislikes}}</span>
	received
	</a>
	<a class="item ">Ask
	<span class="num">{{totalQuestion}}</span>
	questions
	</a>
	<!--
	<a class="item ">Reply
	<span class="num">number of reply</span>
	</a>-->
</div>
<!-- Achievment section -->
<div class="zm-profile-section-wrap achievement">
	<div class="zm-profile-section-head">
		<a class="zm-profile-section-title">
			<h2 class="zm-profile-section-name">Achievement</h2>
		</a>
	</div>
	<div class="achievementimg">
		<img class="medal" id="medal" src="">
		<p id="achievementWords" style="font-size:20px">No ahievement now! You have to work harder!</p>
	</div>
</div>

<!-- Answer section-->

<div class="zm-profile-section-wrap">
	<div class="zm-profile-section-head">
		<a class="zm-profile-section-title">
			<h2 class="zm-profile-section-name">Your 3 most recent posts will be here:</h2>
			<i class="zg-right zg-icon zm-profile-section-more-btn"></i>
		</a>
	</div>
	<div class="zm-profile-section-list" id="zh-profile-answers-inner-list">

		<div class="zm-profile-section-item zg-clear">
			<a class="zm-profile-vote-count" >
				<div class="zm-profile-vote-num" style="display:none" id="likes0">Likes</div>
				<div class="zm-profile-vote-type"><p id="like0" style="display:none" >Likes</p></div>
			</a>
		<!-- want to have three most recent answers here-->
			<div class="zm-profile-section-main">
				<h2 class="zm-profile-question">
					<p class="question_link question" id="q0" style="display:none">You haven't aer question yet!</p>
				</h2>


			</div>
		</div>
		<div class="zm-profile-section-item zg-clear">
			<a class="zm-profile-vote-count" >
				<div class="zm-profile-vote-num" style="display:none" id="likes1">Likes</div>
				<div class="zm-profile-vote-type"><p id="like1" style="display:none">Likes</p></div>
			</a>
		<!-- want to have three most recent answers here-->
			<div class="zm-profile-section-main">
				<h2 class="zm-profile-question">
					<p class="question_link question" id="q1" style="display:none">Question2</p>
				</h2>


			</div>
		</div>
		<div class="zm-profile-section-item zg-clear">
			<a class="zm-profile-vote-count">
				<div class="zm-profile-vote-num" style="display:none" id="likes2">Likes</div>
				<div class="zm-profile-vote-type"><p id="like2"  style="display:none">Likes</p></div>
			</a>
		<!-- want to have three most recent answers here-->
			<div class="zm-profile-section-main">
				<h2 class="zm-profile-question">
					<p class="question_link question" id="q2" style="display:none">Question3</p>
				</h2>
	</div>
</div>


<!-- We have 20 JACK, 50 QUEEN, 100 KING-->

</div>
	<div class="zg-clear"></div>
</div>

</div>

<script>
/*FB.api('/me', function(response) {
    alert("Name: "+ response.name + "\nFirst name: "+ response.first_name + "ID: "+response.id);
    var img_link = "http://graph.facebook.com/"+response.id+"/picture"
    var temp = document.getElementById("username");
    temp.value = response.name;
});*/

</script>
<!-- change the acheivement medal-->
<script>
/*var likes = {{number of likes get}}
	if(likes > 20 && likes <50)
	{
		document.getElementById("medal").src = "img/medal/20.png";
		document.getElementById("achievementWords").innerHTML = "You recieve more than 20 likes!"
	}
	else if(likes>50 && likes<100)
	{
		document.getElementById("medal").src = "img/medal/50.png";
		document.getElementById("achievementWords").innerHTML = "You recieve more than 50 likes!"
	}
	else if(likes>100)
	{
		document.getElementById("medal").src = "img/medal/100.png";
		document.getElementById("achievementWords").innerHTML = "You recieve more than 100 likes!"
	}

*/
</script>
   <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

    <!-- angularJs -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular-sanitize.min.js"></script>
    <script src="js/lib/Autolinker.min.js"></script>
    <script>
    angular.module('homepage', [])
		.controller('homepageMani', ['$scope', '$http', '$window', function($scope, $http, $window) {
			$scope.returnFBusername = function(){
				$http.get('/api/users/current')
				.success(function(result){
				if(! result){
					console.log("Sorry you have to login");
				}
				else{			
					console.log(result.fb.name);
					document.getElementById("username").innerHTML="This is your homepage "+result.fb.name+"! Enjoy your day!"; 
					var totalQuestion = result.questions.length;
					$scope.totalQuestion = totalQuestion;
					console.log($scope.totalQuestion);
					var totalLike = 0;
					var totalDislike = 0;
					//var a = "2015-11-19T09:08:59.081Z";
					//var b = "2015-11-19T09:05:17.692Z";
					if(totalQuestion == 0){
						console.log("I get into totalQuestion = 0 if ")
						document.getElementById('q0').style.display="";
						document.getElementById('q0').innerHTML="You haven't answer question yet!"
						document.getElementById('q0').style.fontSize="20px";
					}
					console.log("total question is "+ totalQuestion);
					var questionid = result.questionIds;

					var updateLike = function(i){
						totalLike += i;
					}
					var updateDislike = function(i){
						totalDislike += i;
					} 
					for(var a=0 ; a<totalQuestion;a++)
					{
						updateLike(result.questions[a].upVote);
						updateDislike(result.questions[a].downVote);
					}
					if(totalQuestion < 4)
					{
						for(var i=0; i<totalQuestion;i++){
							document.getElementById('q'+i).style.display="";
							document.getElementById('q'+i).innerHTML=result.questions[i].wholeMsg;
							document.getElementById('q'+i).style.fontSize="20px";
							document.getElementById('q'+i).style.color="rgb(80,80,80)";
							document.getElementById('like'+i).style.display="";
							var thislike = result.questions[i].upVote;
							var thisdislike = result.questions[i].downVote;
							document.getElementById('like'+i).innerHTML=thislike - thisdislike;
							document.getElementById('likes'+i).style.display='';
						}

					}
					else{
						var date = [];
						var likenumber = [];
						var dislikenumber = [];
						for(var a=0; a<totalQuestion;a++){
							date.push(result.questions[a].createdAt);
							likenumber.push(result.questions[a].upVote);
							dislikenumber.push(result.questions[a].downVote);
						}
						var findlargest = function(array){
							if(array){
								var index = 0;
								var max = array[0];
								var length = array.length;
								for(var i=1; i<length;i++){
									if(array[i]>max){
										max = array[i];
										index = i;
									}
								}
								return index;
							}
						}
						var findsecond = function(array){
							if(array){
								var index = 0;
								var max = array[findlargest(array)];
								var second = array[0];
								var length = array.length;
								for(var i=1;i<length;i++){
									if(array[i] > second && array[i] < max){
										second = array[i];
										index = i;
									}
								}
								return index;
							}
						}
						var findthird = function(array){
							if(array){
								var index = 0;
								var second = array[findsecond(array)];
								var length = array.length;
								var third = array[0];
								for(var i=1; i<length;i++){
									if(array[i]>third && array[i]<second){
										third = array[i];
										index = i;
									}
								}
								return index;
							}
						}
						
						console.log("data length " +date.length);
						
						var testing = [1,2,4,5,100, 6];
						console.log("largest is "+findsecond(testing))
						var firstIndex = findlargest(date);
						console.log("first index is" +firstIndex);
						console.log(result.questions[firstIndex].wholeMsg);
						document.getElementById('q0').style.display="";
						document.getElementById('q0').innerHTML=result.questions[firstIndex].wholeMsg;
						document.getElementById('like0').style.display="";
						document.getElementById('like0').innerHTML= likenumber[firstIndex]-dislikenumber[firstIndex];
						document.getElementById('likes0').style.display="";
						var secondIndex = findsecond(date);
						document.getElementById('q1').style.display="";
						document.getElementById('q1').innerHTML=result.questions[secondIndex].wholeMsg;
						document.getElementById('like1').style.display="";
						document.getElementById('like1').innerHTML= likenumber[secondIndex]-dislikenumber[secondIndex];
						document.getElementById('likes1').style.display="";
						var thirdIndex = findthird(date); 
						document.getElementById('q2').style.display="";
						document.getElementById('q2').innerHTML=result.questions[thirdIndex].wholeMsg;
						document.getElementById('like2').style.display="";
						document.getElementById('like2').innerHTML= likenumber[thirdIndex]-dislikenumber[thirdIndex];
						document.getElementById('likes2').style.display="";
					}
					
					$scope.likes = totalLike;
					$scope.dislikes = totalDislike;
					if(totalLike > 20 && totalLike < 50){
						document.getElementById("medal").src = "img/medal/20.png";
						document.getElementById("achievementWords").innerHTML = "You recieve more than 20 likes!"
					}
					else if(totalLike>50 && totalLike < 100){
						document.getElementById("medal").src = "img/medal/50.png";
						document.getElementById("achievementWords").innerHTML = "You recieve more than 50 likes!"	
					}
					else if(totalLike > 100){
						document.getElementById("medal").src = "img/medal/100.png";
						document.getElementById("achievementWords").innerHTML = "You recieve more than 100 likes!"		
					}
				}
				})
				
			}
		}]);
    </script>
    <!-- Bootstrap -->
    <script src="webjs/bootstrap.min.js"></script>

    <!-- local scripts for our application -->
    <script src="js/lib/ngStorage.min.js"></script>
    <!--
    <script src="js/app.js"></script>
    <script src="js/controllers/homepage.js"></script>-->

<input type="hidden" name="_xsrf" value="3d99b059b816aca9a5c5a74687857108"/>
</body>
</html>